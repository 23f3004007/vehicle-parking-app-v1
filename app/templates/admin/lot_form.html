{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h3>{{ 'Edit' if lot else 'Add' }} Parking Lot</h3>
        </div>
        <div class="card-body">
            <form method="POST" id="lotForm" onsubmit="return validateLotForm()">
                <div class="mb-3">
                    <label for="name" class="form-label">Location Name</label>
                    <input type="text" class="form-control" id="name" name="name" 
                           value="{{ lot.prime_location_name if lot else '' }}" 
                           required minlength="3" maxlength="100">
                    <div class="invalid-feedback">Location name must be 3-100 characters long.</div>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <textarea class="form-control" id="address" name="address" 
                              required minlength="10" maxlength="200">{{ lot.address if lot else '' }}</textarea>
                    <div class="invalid-feedback">Address must be 10-200 characters long.</div>
                </div>
                <div class="mb-3">
                    <label for="pin_code" class="form-label">PIN Code</label>
                    <input type="text" class="form-control" id="pin_code" name="pin_code" 
                           value="{{ lot.pin_code if lot else '' }}" 
                           required pattern="[0-9]{6}">
                    <div class="invalid-feedback">PIN Code must be exactly 6 digits.</div>
                </div>
                <div class="mb-3">
                    <label for="price_per_hour" class="form-label">Price per Hour (₹)</label>
                    <input type="number" step="0.01" class="form-control" id="price_per_hour" 
                           name="price_per_hour" value="{{ lot.price_per_hour if lot else '' }}" 
                           required min="0.01" max="10000">
                    <div class="invalid-feedback">Price must be between ₹0.01 and ₹10,000.</div>
                </div>
                {% if not lot %}
                <div class="mb-3">
                    <label for="max_spots" class="form-label">Maximum Parking Spots</label>
                    <input type="number" class="form-control" id="max_spots" name="max_spots" 
                           required min="1" max="1000">
                    <div class="invalid-feedback">Number of spots must be between 1 and 1000.</div>
                </div>
                {% endif %}
                <button type="submit" class="btn btn-primary">{{ 'Update' if lot else 'Create' }} Lot</button>
                <a href="{{ url_for('admin.manage_lots') }}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
</div>
{% endblock %}

<script>
function validateLotForm() {
    const name = document.getElementById('name');
    const address = document.getElementById('address');
    const pinCode = document.getElementById('pin_code');
    const pricePerHour = document.getElementById('price_per_hour');
    const maxSpots = document.getElementById('max_spots');
    let isValid = true;

    // Name validation
    if (name.value.length < 3 || name.value.length > 100) {
        name.classList.add('is-invalid');
        isValid = false;
    } else {
        name.classList.remove('is-invalid');
    }

    // Address validation
    if (address.value.length < 10 || address.value.length > 200) {
        address.classList.add('is-invalid');
        isValid = false;
    } else {
        address.classList.remove('is-invalid');
    }

    // PIN Code validation
    if (!pinCode.value.match(/^[0-9]{6}$/)) {
        pinCode.classList.add('is-invalid');
        isValid = false;
    } else {
        pinCode.classList.remove('is-invalid');
    }

    // Price validation
    const price = parseFloat(pricePerHour.value);
    if (isNaN(price) || price < 0.01 || price > 10000) {
        pricePerHour.classList.add('is-invalid');
        isValid = false;
    } else {
        pricePerHour.classList.remove('is-invalid');
    }

    // Max spots validation (only for new lots)
    if (maxSpots && (maxSpots.value < 1 || maxSpots.value > 1000)) {
        maxSpots.classList.add('is-invalid');
        isValid = false;
    } else if (maxSpots) {
        maxSpots.classList.remove('is-invalid');
    }

    return isValid;
}
</script>